<?xml version="1.0" encoding="utf-8"?>

<Page
    x:Class="Downloader.Modules.AskWindow.Views.MainPage"
    xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
    xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
    xmlns:local="using:Downloader.Modules.AskWindow.Views"
    xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
    xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
    mc:Ignorable="d">

    <Page.Resources>
        <Storyboard x:Name="CopyUrlButtonAnimationStart">
            <DoubleAnimation Storyboard.TargetName="CopyIcon"
                             Storyboard.TargetProperty="Opacity"
                             To="0" Duration="0:0:0" />
            <DoubleAnimation Storyboard.TargetName="AcceptIcon"
                             Storyboard.TargetProperty="Opacity"
                             To="1" Duration="0:0:0.2" />
        </Storyboard>
        <Storyboard x:Name="CopyUrlButtonAnimationEnd">
            <DoubleAnimation Storyboard.TargetName="AcceptIcon"
                             Storyboard.TargetProperty="Opacity"
                             To="0"
                             Duration="0:0:0" />
            <DoubleAnimation Storyboard.TargetName="CopyIcon"
                             Storyboard.TargetProperty="Opacity"
                             To="1"
                             Duration="0:0:0.2" />
        </Storyboard>

        <local:FilesizeToStringConverter x:Name="FilesizeToStringConverter" />
        <local:IsCompletedToVisibilityForGrid x:Name="CompletedToVisibilityForGrid" />
        <local:IsCompletedToVisibilityForProgressRing x:Name="CompletedToVisibilityForProgressRing" />
    </Page.Resources>

    <Grid>
        <Grid.RowDefinitions>
            <RowDefinition Height="Auto" />
            <RowDefinition Height="Auto" />
            <RowDefinition Height="*" />
        </Grid.RowDefinitions>
        <TitleBar Grid.Row="0"
                  x:Uid="Titlebar"
                  Subtitle="{x:Bind ViewModel.FileName}" />
        <Grid Grid.Row="1"
              Margin="16,16,16,8">
            <Grid.ColumnDefinitions>
                <ColumnDefinition Width="Auto" />
                <ColumnDefinition Width="*" />
                <ColumnDefinition Width="Auto" />
            </Grid.ColumnDefinitions>
            <TextBlock Grid.Column="0"
                       Text="Url:"
                       VerticalAlignment="Center"
                       Style="{StaticResource BodyStrongTextBlockStyle}"
                       Margin="4,0" />
            <TextBox Grid.Column="1"
                     Margin="4,0"
                     Text="{x:Bind ViewModel.Url,Mode=TwoWay}" />
            <Button Grid.Column="2"
                    Command="{x:Bind ViewModel.CopyUrlCommand}"
                    ToolTipService.ToolTip="Copy url">
                <Grid>
                    <FontIcon x:Name="CopyIcon" Glyph="&#xE8C8;" />
                    <FontIcon x:Name="AcceptIcon" Glyph="&#xE8FB;" Opacity="0" />
                </Grid>
            </Button>
        </Grid>
        <Grid Grid.Row="2">
            <Grid.RowDefinitions>
                <RowDefinition Height="*" />
                <RowDefinition Height="Auto" />
            </Grid.RowDefinitions>
            <Grid Grid.Row="0">
                <Grid.ColumnDefinitions>
                    <ColumnDefinition Width="3*" />
                    <ColumnDefinition Width="*" />
                </Grid.ColumnDefinitions>
                <StackPanel Grid.Column="0"
                            Orientation="Vertical"
                            Spacing="8"
                            Margin="16,8">
                    <Grid>
                        <Grid.ColumnDefinitions>
                            <ColumnDefinition Width="Auto" />
                            <ColumnDefinition Width="*" />
                        </Grid.ColumnDefinitions>
                        <TextBlock Grid.Column="0"
                                   Margin="4,0"
                                   Text="File name:"
                                   VerticalAlignment="Center"
                                   Style="{StaticResource BodyStrongTextBlockStyle}" />
                        <TextBox Grid.Column="1"
                                 IsEnabled="{x:Bind ViewModel.IsCompleted,Mode=OneWay}"
                                 Text="{x:Bind ViewModel.FileName,Mode=TwoWay}" />
                    </Grid>
                </StackPanel>
                <Border Grid.Column="1"
                        Margin="4"
                        Padding="4"
                        CornerRadius="8">
                    <StackPanel
                        Orientation="Vertical"
                        Spacing="8">
                        <Grid>
                            <Grid HorizontalAlignment="Center"
                                  Visibility="{x:Bind ViewModel.IsCompleted,Mode=OneWay,Converter={StaticResource CompletedToVisibilityForGrid}}">
                                <Grid.ColumnDefinitions>
                                    <ColumnDefinition Width="Auto" />
                                    <ColumnDefinition Width="*" />
                                </Grid.ColumnDefinitions>
                                <FontIcon Grid.Column="0" Glyph="&#xEB3B;"
                                          Margin="4,0" />
                                <StackPanel Grid.Column="1"
                                            Orientation="Horizontal"
                                            Spacing="4">
                                    <TextBlock
                                        Text="{x:Bind ViewModel.FileSize,Mode=OneWay,Converter={StaticResource FilesizeToStringConverter}}" />
                                </StackPanel>
                            </Grid>
                            <ProgressRing IsActive="True"
                                          HorizontalAlignment="Center"
                                          Visibility="{x:Bind ViewModel.IsCompleted,Mode=OneWay,Converter={StaticResource CompletedToVisibilityForProgressRing}}" />
                        </Grid>
                        <Border BorderBrush="Gray"
                                BorderThickness="1"
                                Height="1"
                                Margin="8,4"
                                HorizontalAlignment="Stretch" />
                        <Button HorizontalAlignment="Center"
                                Command="{x:Bind ViewModel.RetryCommand}"
                                IsEnabled="{x:Bind ViewModel.IsCompleted,Mode=OneWay}">
                            <FontIcon Glyph="&#xE72C;" />
                        </Button>
                    </StackPanel>
                </Border>
            </Grid>
            <StackPanel Grid.Row="1" Orientation="Horizontal"
                        VerticalAlignment="Bottom"
                        HorizontalAlignment="Right"
                        Margin="8"
                        Spacing="8">
                <Button Content="Cancel"
                        Command="{x:Bind ViewModel.CloseCommand}" />
                <Button Content="Download"
                        IsEnabled="{x:Bind ViewModel.IsCompleted,Mode=OneWay}"
                        Style="{StaticResource AccentButtonStyle}"
                        Command="{x:Bind ViewModel.NewDownloaderCommand}"/>
            </StackPanel>
        </Grid>
    </Grid>
</Page>